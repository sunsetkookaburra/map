<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="./map.png"/>
  <link rel="stylesheet" href="./leaflet.css"/>
  <script src="./leaflet.js"></script>
  <title>maps ~sunsetkookaburra</title>
  <style>
    body {
      margin: 0;
    }
    #map {
      margin: auto;
      width: 100%;
      height: calc(100vh);
    }
  </style>
</head>
<body>
  <figure id="map"></figure>
  <script>
    const SYDNEY = L.latLng(-33.85, 151.20);

    const map = L.map("map", {
      center: SYDNEY,
      zoom: 13,
    });

    const osm = L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    }).addTo(map);

    const six = L.tileLayer("https://maps{s}.six.nsw.gov.au/arcgis/rest/services/sixmaps/LPI_Imagery_Best/MapServer/tile/{z}/{y}/{x}", {
      subdomains: "1234",
      maxZoom: 21,
      attribution: '&copy; <a href="https://maps.six.nsw.gov.au/">NSW Gov. CC-BY 4.0</a>'
    });

    const esri = L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}.png", {
      maxZoom: 19,
      attribution: '&copy; ESRI',
    });

    const six1943 = L.tileLayer("https://maps.six.nsw.gov.au/arcgis/rest/services/sixmaps/sydney1943/MapServer/tile/{z}/{y}/{x}", {
      maxZoom: 19,
    });

    L.control.layers({
      "üó∫Ô∏è OpenStreetMap": osm,
      "üê® NSW Imagery": six,
      "‚úàÔ∏è Sydney 1943": six1943,
      "üõ∞Ô∏è ESRI World Imagery": esri,
    }).addTo(map);

    L.control.scale().addTo(map);

    const loc = L.popup();

    map.on("click", function (ev) {
      loc.setLatLng(ev.latlng)
        .setContent(`Location<br/><a href="#${ev.latlng.lat},${ev.latlng.lng}"><span style="user-select:none">Lat: </span>${ev.latlng.lat},<br/><span style="user-select:none">Lon: </span>${ev.latlng.lng}</a>`)
        .openOn(map);
    });

    function panHash(smooth = true) {
      const hash = window.location.hash;
      const latlng = L.latLng((hash && hash.slice(1).split(",").map(Number)) ?? SYDNEY);
      if (!hash) return;
      loc.setLatLng(latlng)
        .setContent(`Location<br/><a href="#${latlng.lat},${latlng.lng}"><span style="user-select:none">Lat: </span>${latlng.lat},<br/><span style="user-select:none">Lon: </span>${latlng.lng}</a>`)
        .openOn(map);
      map.panTo(latlng, { animate: smooth });
    }

    window.addEventListener("hashchange", function (ev) {
      panHash();
    });

    window.addEventListener("DOMContentLoaded", function (ev) {
      panHash(false);
    });

    L.Control.Home = L.Control.extend({
      onAdd: function (map) {
        const btn = L.DomUtil.create("button");
        L.DomEvent.disableClickPropagation(btn);
        L.DomEvent.on(btn, "click", function (ev) {
          window.location = window.location.pathname;
        })
        btn.textContent = "üè†";
        return btn;
      },
      onRemove: function (map) {
        L.DomEvent.off(this._container);
      },
    });

    L.control.home = function (opts) {
      return new L.Control.Home(opts);
    }

    L.control.home({ position: "topleft" }).addTo(map);
  </script>
</body>
</html>
